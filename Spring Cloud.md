# Spring Cloud

### CAP与BASE

#### CAP

1. 一致性

   所有节点在同一时间的数据完全一致

2. 可用性

   服务一直可用, 而且时正常响应时间

3. 分区容错性

   分布式系统在遇到某节点或网络分区故障的时候, 仍能对外提供满足一致性和可用性的服务

#### BASE

1. 基本可用 Basically Available

   分布式系统出现故障时, 允许损失部分可用性, 即保证核心可用

2. 软状态 Soft State

   允许系统存在中间状态, 而中间状态不会影响系统可用性

3. 最终一致性 Eventual Consistency

   系统的所有数据副本结果一段时间后, 最终能达到一致的状态

### 微服务

1. 大小适当
2. 位置透明
3. 有弹性
4. 可重复
5. 可伸缩

#### 核心微服务开发模式

核心微服务开发模式解决构建微服务的基础问题

1. 服务粒度

2. 通讯协议

3. 接口设计

   如何将服务端点公开给客户端

4. 服务的配置管理

   服务如何管理应用程序的特定配置,以便代码和配置成为独立的实体

5. 服务间事件处理

   如何使用事件来传达服务间的状态和数据变更

#### 微服务路由模式

微服务路由模式负责处理希望消费微服务的客户端应用程序,使客户端应用程序发现服务的位置并路由到服务

1. 服务发现

   如何使微服务变得可以被发现, 以便客户端应用程序在不需要硬编码服务位置到应用程序的情况下找到它们.

   从客户端抽象出服务的物理位置, 可以添加新的微服务实例来进行扩大, 并且可以透明的删除不健康的服务实例.

2. 服务路由

   如何为所有服务提供单个入口点, 以便将安全策略和路由规则统一应用于多个服务和服务实例.

   为微服务客户端提供单一的逻辑URL来进行通信, 并作为授权, 验证和内容检查等内容的策略实施点.

#### 微服务客户端弹性模式

如何防止单个服务(或服务实例)中的问题级联暴露给服务的消费者.

1. 客户端负载均衡

2. 断路器模式

   如何阻止客户继续调用出现故障的或遭遇性能问题的服务.

3. 后备模式

   当服务调用失败时, 如何提供插件机制, 允许客户端尝试调用微服务之外的其他方法

4. 舱壁模式

   微服务应用程序使用多个分布式资源来执行工作. 如何区分执行调用, 以便表现不佳的服务调用不会对应用程序产生其他部分的负面影响

#### 微服务安全模式

1. 验证

   如何确定调用服务的客户端就是它们声明的那个主体

2. 授权 

   如何确定调用微服务的客户端是否允许执行它们正在进行的操作

3. 凭据管理和传播

   如何避免客户端每次都要提供凭据信息才能访问事务中涉及的服务调用

#### 微服务日志记录和跟踪模式

1. 日志关联

   一个用户事务会调用多个服务, 如何将这些服务所生成的日志关联在一起?

   如何实现一种关联(correlation)ID, 这是一个唯一标识符, 在事务中调用所有服务都会携带它, 通过它能够将每个服务生成的日志条目联系起来

2. 日志聚合

   如何将微服务(及其各个实例)生成的日志合并到一个可查询的数据库

3. 微服务跟踪

   可视化客户端事务的流程, 并了解事务所涉及的服务的性能特征





#### RPC And Http

##### RPC

Remote Produce Call 自定义数据格式

```yaml
spring:
	application:
		name: serverName
```



#### Eureka

服务注册与发现

client-server结构

`@EnableDiscoveryClient`, `@EnableEurekaServer`

```yaml
spring:
	eureka:
		client:
			server-url:
				defaultZone: http://localhost:12345/eureka

			
```



#### Zuul

网关

#### Ribbon

负载均衡

#### Feign

声明式服务调用

#### Hystrix

容错管理组件



### Spring Security oAuth2

#### RBAC 权限控制模型

1. WHO

   资源所有者

   user, manager, system

2. WHAT

   能访问哪些资源

   静态资源

   动态资源

3. HOW

   具体怎么访问

   CRUD

* 一个用户可以有多种角色
* 一个角色可以有多种权限

模型

* user 用户
* role 角色
* permission 权限
* user_role
* role_permission

